import React,{useEffect,useState} from 'react';export default function Decisions({API}){const[d,setD]=useState([]);const[role,setRole]=useState('farm');const load=async()=>{const r=await (await fetch(`${API}/decisions`)).json();setD(r.decisions||[])};const act=async()=>{await fetch(`${API}/decide`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({agent_id:'demo:'+role,role})});load()};useEffect(()=>{load();const id=setInterval(load,4000);return()=>clearInterval(id)},[API]);return(<section className='grid grid-cols-1 lg:grid-cols-2 gap-6'><div className='card'><div className='flex items-center justify-between'><h3 className='font-semibold mb-2'>Decision Memos</h3><div className='flex items-center gap-2'><select className='border rounded px-2 py-1' value={role} onChange={e=>setRole(e.target.value)}><option>farm</option><option>processor</option><option>distributor</option><option>retail</option></select><button className='px-3 py-1 rounded bg-slate-900 text-white' onClick={act}>Take decision</button></div></div><div className='max-h-72 overflow-auto text-sm'>{d.slice().reverse().map((m,i)=>(<div key={i} className='border-b py-2'><div className='font-semibold'>{(m.time||'').replace('T',' ').slice(0,16)} â€” {m.decision}</div><div>SLCA: <b>{m.slca}</b> | Carbon: {m.carbon_kg} kg | Price: {m.unit_price}</div><div>Agent: {m.agent} ({m.role}) | Shelf: {m.shelf_left} | Volatility: {m.volatility} | tx: {m.tx}</div><div className='text-slate-600'>{m.note}</div></div>))}</div></div><div className='card'><h3 className='font-semibold mb-2'>Download Report</h3><a className='px-3 py-2 rounded bg-slate-900 text-white inline-block' href={`${API}/report/pdf`} target='_blank'>Download Decision Memo (PDF)</a><div className='text-xs text-slate-600 mt-2'>KPIs + latest decision with SLCA, carbon, tx hash.</div></div></section>)}
