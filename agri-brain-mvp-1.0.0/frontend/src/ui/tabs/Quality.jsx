import React,{useEffect,useMemo,useState} from 'react';import {LineChart,Line,XAxis,YAxis,Tooltip,CartesianGrid,ResponsiveContainer,AreaChart,Area,Legend} from 'recharts';export default function Quality({API}){const[tel,setTel]=useState(null);const[pred,setPred]=useState(null);useEffect(()=>{const f=async()=>{const t=await (await fetch(`${API}/telemetry`)).json();const p=await (await fetch(`${API}/predictions`)).json();setTel(t);setPred(p)};f();const id=setInterval(f,5000);return()=>clearInterval(id)},[API]);const series=useMemo(()=>{if(!tel||!pred) return [];return tel.timestamp.map((t,i)=>({t,tempC:tel.tempC[i],RH:tel.RH[i],ambientC:tel.ambientC[i],shockG:tel.shockG[i],demand:tel.demand_units[i],shelf:pred.shelf_left[i]}))},[tel,pred]);return(<section className='grid grid-cols-1 lg:grid-cols-2 gap-6'><Chart title='IoT: Temp & Humidity'><ResponsiveContainer width='100%' height='100%'><LineChart data={series}><CartesianGrid strokeDasharray='3 3'/><XAxis dataKey='t' hide/><YAxis/><Tooltip/><Legend/><Line type='monotone' dataKey='tempC' dot={false} name='Temp °C'/><Line type='monotone' dataKey='RH' dot={false} name='Humidity %'/></LineChart></ResponsiveContainer></Chart><Chart title='Spoilage: Shelf‑life Remaining'><ResponsiveContainer width='100%' height='100%'><AreaChart data={series}><CartesianGrid strokeDasharray='3 3'/><XAxis dataKey='t' hide/><YAxis domain={[0,1]}/><Tooltip/><Area type='monotone' dataKey='shelf' fillOpacity={0.2} name='Shelf Left'/></AreaChart></ResponsiveContainer></Chart></section>)}
function Chart({title,children}){return <div className='card'><h3 className='font-semibold mb-2'>{title}</h3><div className='h-64'>{children}</div></div>}
